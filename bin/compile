#!/bin/bash

set -e

# Install dependencies
apt-get update && apt-get install -y \
  autoconf \
  automake \
  build-essential \
  git \
  pkg-config \
  wget \
  libglib2.0-dev \
  libheif-dev \
  libde265-dev \
  x265

# Install libde265
cd /tmp
git clone https://github.com/strukturag/libde265.git
cd libde265
./autogen.sh
./configure --prefix=/app/local
make
make install

# Install x265
cd /tmp
hg clone https://bitbucket.org/multicoreware/x265
cd x265/build/linux
cmake -DCMAKE_INSTALL_PREFIX=/app/local ../../source
make
make install

# Install libheif
cd /tmp
git clone https://github.com/strukturag/libheif.git
cd libheif
./autogen.sh
./configure --prefix=/app/local --with-libde265 --with-x265
make
make install

# Clean up
rm -rf /tmp/libde265
rm -rf /tmp/x265
rm -rf /tmp/libheif

echo "Libraries installed"
